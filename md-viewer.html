<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Markdown Viewer</title>
  <script src="/todom3/js/marked.min.js"></script>
  <link type="text/css" rel="stylesheet" href="/todom3/css/styles.css" />
</head>
<body>
  <div class="container">
  <!--  Mirroring the Todom app structure -->
    <div class="flex-row w-1440">
      <div id="content" class="flex-small">
        <div id="main-listing" class="flex-row markdown-body">
          <ol id="list-files" style="display: flex;">
            <li id="0">
              <div class="dual">
                <div class="md-file">
                  <div class="resizable-div">
                    Loading ...
                  </div>
                </div>
              </div>
            </li>
          </ol>
        </div>
      </div>
    </div>
  </div>

<script type="text/javascript" src="/todom3/js/earliest-togglers.js"></script>

<script>
(function() {
const _pathname = window.location.pathname;
const _search = window.location.search;
console.log("Viewer loaded, path =", _pathname);
var resizableDiv = document.querySelector(".resizable-div");

if (!_search.endsWith(".md")) {
    resizableDiv.textContent = "Not a Markdown file.";
    return;
}

const mdURL = _search.split('?')[1];
console.log("Fetching raw markdown from:", mdURL);

fetch(mdURL)
    .then(r => {
    if (!r.ok) throw new Error("Status " + r.status);
    return r.text();
    })
    .then(md => {
    console.log("Fetched MD (snippet):", md.slice(0,50));
    resizableDiv.innerHTML = marked.parse(md);
    document.title = mdURL.split("/").pop();
    })
    .catch(e => {
    console.error("MD load error:", e);
    resizableDiv.textContent = "Error loading file.";
    });
})();
</script>


</body>
</html>
